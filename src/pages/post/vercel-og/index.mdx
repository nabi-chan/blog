---
title: '@vercel/og ë¥¼ ì‚¬ìš©í•´ NextJSì—ì„œ ë¸”ë¡œê·¸ ë¯¸ë¦¬ë³´ê¸° ë§Œë“¤ê¸°!'
description: Vercelì—ì„œ ë¦´ë¦¬ì¦ˆí•œ @vercel/og ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì´ìš©í•˜ì—¬ ë¸”ë¡œê·¸ ë¯¸ë¦¬ë³´ê¸°ë¥¼ ë§Œë“œëŠ” ì˜ˆì œë¥¼ ì œê³µí•©ë‹ˆë‹¤.
date: 2024-04-02 23:57
layout: post
tags:
  - vercel/og
  - ë¼ì´ë¸ŒëŸ¬ë¦¬
---

## @vercel/og ë€ ë¬´ì—‡ì¼ê¹Œ

Vercelì—ì„œ ì œì‘í•œ SVG í˜•íƒœì˜ ì´ë¯¸ì§€ ì œì‘ ë¼ì´ë¸ŒëŸ¬ë¦¬ì¸ Satorië¥¼ NextJS í™˜ê²½ì—ì„œ ì›í™œí•˜ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ ì„¤ì •ì„ ì¶”ê°€í•´ resvg ì—†ì´ë„ png í˜•íƒœì˜ ì´ë¯¸ì§€ë¥¼ ì‰½ê²Œ ì œì‘í•  ìˆ˜ ìˆëŠ” OpenGraphì— ìµœì í™”ëœ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì…ë‹ˆë‹¤.

## ì–´ë–»ê²Œ ì‚¬ìš©í• ê¹Œ

### ê¸°ë³¸ì ì¸ ì‚¬ìš©ë²•

- vercel/og ëŠ” ê¸°ë³¸ì ìœ¼ë¡œ edge runtime ì— ìµœì í™” ë˜ì–´ìˆìŠµë‹ˆë‹¤.
- ë‹¤ìŒê³¼ ê°™ì´, runtimeì„ edgeë¡œ ì„¤ì •í•˜ê³ , `new ImageResponse()` ë¥¼ í˜¸ì¶œí•˜ì—¬ ì´ë¯¸ì§€ë¥¼ ë§Œë“¤ì–´ë‚¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- ì¼ë°˜ react í™˜ê²½ì—ì„œ inline-styleì„ ì¶”ê°€í•  ë•Œ ì²˜ëŸ¼, style ê°ì²´ë¥¼ ì‚¬ìš©í•´ ìŠ¤íƒ€ì¼ì„ ì§€ì •í•´ì¤„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```tsx filename="example.tsx"
import { ImageResponse } from '@vercel/og';

export const config = {
  runtime: 'edge',
};

export default async function handler() {
  return new ImageResponse(
    (
      <div
        style={{
          fontSize: 40,
          color: 'black',
          background: 'white',
          width: '100%',
          height: '100%',
          padding: '50px 200px',
          textAlign: 'center',
          justifyContent: 'center',
          alignItems: 'center',
        }}
      >
        ğŸ‘‹ Hello World!
      </div>
    ),
    {
      width: 1200,
      height: 630,
    },
  );
}
```

![Untitled](./common-example.png)

### ì´ë¯¸ì§€ ë¦¬ì‚¬ì´ì¦ˆ í•˜ê¸°

- optionì˜ í•„ìˆ˜ ì¸ìì¸ `width` ì™€ `height` ë¥¼ ì¡°ì‘í•¨ìœ¼ë¡œì¨ ì´ë¯¸ì§€ì˜ í¬ê¸°ë¥¼ ê²°ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- ì´ ì˜ˆì œì—ì„œëŠ” 400x400ì˜ ì´ë¯¸ì§€ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.

```tsx filename="resize.tsx"
import { ImageResponse } from '@vercel/og';

export const config = {
  runtime: 'edge',
};

export default async function handler() {
  return new ImageResponse(
    (
      <div
        style={{
          fontSize: 40,
          color: 'black',
          background: 'white',
          width: '100%',
          height: '100%',
          padding: '50px 200px',
          textAlign: 'center',
          justifyContent: 'center',
          alignItems: 'center',
        }}
      >
        ğŸ‘‹ Hello World!
      </div>
    ),
    {
      // ì´ ë¶€ë¶„ì˜ ê°’ì„ ìˆ˜ì •í•˜ë©´ ë‹¤ì–‘í•œ ì‚¬ì´ì¦ˆì˜ ì´ë¯¸ì§€ë¥¼ ë§Œë“¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
      width: 400,
      height: 400,
    },
  );
}
```

![Untitled](./resize-example.png)

### ì»¤ìŠ¤í…€ í°íŠ¸ ì‚¬ìš©í•˜ê¸°

- font íŒŒì¼ì„ fetch í•¨ìˆ˜ë¥¼ í†µí•´ ê°€ì ¸ì˜¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- ttf / woff ë“±ì˜ ë‹¤ì–‘í•œ í°íŠ¸ í˜•ì‹ì„ ê°€ì ¸ì˜¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- font íŒŒì¼ì€ apië¥¼ í˜¸ì¶œí•˜ëŠ” í´ë”ì™€ ë™ì¼í•œ ê²½ë¡œì— ìˆì–´ì•¼ í•©ë‹ˆë‹¤.
  - ë§Œì•½ `fetch('./font.woff', import.meta.url)` ì˜ í˜•ì‹ìœ¼ë¡œ ì‹¤í–‰í•  ê²½ìš°â€¦
  - font.woff íŒŒì¼ì€ apië¥¼ í˜¸ì¶œí•˜ëŠ” í´ë”ì™€ ê°™ì€ ê³µê°„ì— ìˆì–´ì•¼ í•©ë‹ˆë‹¤.

```tsx filename="custom-font.tsx"
import { ImageResponse } from '@vercel/og';

export const config = {
  runtime: 'edge',
};

export default async function handler() {
  // new URL() ì„ í†µí•´ font.woffì˜ ì£¼ì†Œë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ìˆê²Œ ë©ë‹ˆë‹¤.
  // ìì„¸í•œ ë‚´ìš©ì€ : https://developer.mozilla.org/ko/docs/Web/JavaScript/Reference/Operators/import.meta#í˜„ì¬_íŒŒì¼ì„_ê¸°ì¤€ìœ¼ë¡œ_íŒŒì¼_í™•ì¸í•˜ê¸°
  const fontBuffer = await fetch(new URL('pretendard-bold.woff', import.meta.url)).then((res) => res.arrayBuffer());

  return new ImageResponse(
    (
      <div
        style={{
          fontSize: 40,
          color: 'black',
          background: 'white',
          width: '100%',
          height: '100%',
          padding: '50px 200px',
          textAlign: 'center',
          justifyContent: 'center',
          alignItems: 'center',
        }}
      >
        ğŸ‘‹ Hello World!
      </div>
    ),
    {
      width: 400,
      height: 400,
      // ë°°ì—´ì— ë‹¤ì–‘í•œ êµµê¸° / í˜•íƒœì˜ í°íŠ¸ë¥¼ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
      fonts: [
        {
          data: fontBuffer,
          name: 'font',
          weight: 400,
        },
      ],
    },
  );
}
```

![Untitled](./font-example.png)

### ë™ì ì¸ ë‚´ìš© ê°€ì ¸ì˜¤ê¸°

- ì‚¬ìš©ìê°€ ì…ë ¥í•œ ë‚´ìš©ì— ë”°ë¼ ì´ë¯¸ì§€ë¥¼ ë§Œë“¤ê³  ì‹¶ë‹¤ë©´, searchParamsë¥¼ í†µí•˜ì—¬ ë™ì ì¸ ì´ë¯¸ì§€ë¥¼ ë§Œë“¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
  - searchParamsì´ë€? `https://nabi-blog.vercel.app?query=hello` ë¼ëŠ” URLì´ ìˆì„ ë•Œ, queryì™€ ê°™ì´ ? ë’¤ì— ë¶™ëŠ” ë‚´ìš©ì„ ëœ»í•©ë‹ˆë‹¤.
- `new URL(request.url).searchParams.get("ê°€ì ¸ì˜¬_searchParamì˜_ì´ë¦„")` ì„ í†µí•˜ì—¬ ì‚¬ìš©ìê°€ ì…ë ¥í•œ ë‚´ìš©ì„ ê°€ì ¸ì˜¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```tsx filename="dynamic-content.tsx"
import { ImageResponse } from '@vercel/og';

export const config = {
  runtime: 'edge',
};

export default async function handler(request: Request) {
  const query = new URL(request.url).searchParams;
  const content = query.get('content') || 'Type Some Content...';

  return new ImageResponse(
    (
      <div
        style={{
          fontSize: 40,
          color: 'black',
          background: 'white',
          width: '100%',
          height: '100%',
          padding: '50px 200px',
          textAlign: 'center',
          justifyContent: 'center',
          alignItems: 'center',
        }}
      >
        {content}
      </div>
    ),
    {
      width: 800,
      height: 400,
    },
  );
}
```

![Untitled](./dynamic-example.png)

## ì‹¤ì „ì—ì„œ ì‚¬ìš©í•´ë³´ê¸°

### ë¸”ë¡œê·¸ ë¯¸ë¦¬ë³´ê¸° ë§Œë“¤ê¸°

ì´ë¯¸ì§€ë¥¼ ë¶ˆëŸ¬ì˜¤ê³ , dim ì²˜ë¦¬ë¥¼ í•¨ìœ¼ë¡œì¨ ì˜ˆìœ ë¸”ë¡œê·¸ ë¯¸ë¦¬ë³´ê¸°ë¥¼ ë§Œë“¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```tsx filename="blog-preview.tsx"
import { ImageResponse } from '@vercel/og';

export const config = {
  runtime: 'edge',
};

export default async function handler(request: Request) {
  const query = new URL(request.url).searchParams;
  const title = query.get('title') || 'ë¸”ë¡œê·¸ ì œëª©';
  const content = query.get('content') || 'ë¸”ë¡œê·¸ ë‚´ìš©';

  return new ImageResponse(
    (
      <div
        style={{
          height: '100%',
          width: '100%',
          display: 'flex',
          flexDirection: 'column',
          justifyContent: 'space-between',
          padding: 32,
          backgroundColor: '#fff',
          color: '#fff',
        }}
      >
        {/* ë°°ê²½í™”ë©´ */}
        <img
          src="https://images.unsplash.com/photo-1511044568932-338cba0ad803?q=80&width=800&height=400"
          alt="background image"
          style={{
            objectFit: 'cover',
            width: '100vw',
            height: '100vh',
            position: 'absolute',
          }}
        />
        {/* dim ì²˜ë¦¬ */}
        <div
          style={{
            width: '100vw',
            height: '100vh',
            position: 'absolute',
            backgroundColor: 'rgba(0, 0, 0, 0.3)',
          }}
        />
        {/* ë³¸ë¬¸ */}
        <div
          style={{
            display: 'flex',
            flexDirection: 'column',
          }}
        >
          <span
            style={{
              fontSize: 32,
              fontWeight: 600,
            }}
          >
            {title}
          </span>
          <span
            style={{
              fontSize: 18,
            }}
          >
            {content}
          </span>
        </div>

        <div
          style={{
            fontSize: 16,
            fontWeight: 600,
          }}
        >
          Someone's Blog
        </div>
      </div>
    ),
    {
      width: 800,
      height: 400,
    },
  );
}
```

![Untitled](./blog-image-example.png)

### ì§ˆë¬¸ ë¯¸ë¦¬ë³´ê¸° ë§Œë“¤ê¸°

ê°„ë‹¨í•œ ë””ìì¸ì„ í†µí•´, ask.fm ê°™ì€ ì§ˆë¬¸ ë¯¸ë¦¬ë³´ê¸°ë¥¼ ë§Œë“¤ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.

```tsx filename="question-preview.tsx"
import { ImageResponse } from '@vercel/og';

export const config = {
  runtime: 'edge',
};

export default async function handler(request: Request) {
  const query = new URL(request.url).searchParams;
  const questionID = query.get('id') || '0';

  // DBì—ì„œ ë‚´ìš©ì„ ê°€ì ¸ì˜¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
  const question = await database.findOne(questionID);

  return new ImageResponse(
    (
      <div
        style={{
          width: '100vw',
          height: '100vh',
          backgroundColor: '#fff',
          padding: 32,
          display: 'flex',
        }}
      >
        <div
          style={{
            width: '100%',
            height: '100%',
            border: 'dashed 3px black',
            borderRadius: 16,
            display: 'flex',
            flexDirection: 'column',
            justifyContent: 'center',
            alignItems: 'center',
            whiteSpace: 'pre-wrap',
            fontSize: 24,
            fontWeight: 700,
          }}
        >
          {question}
        </div>
      </div>
    ),
    {
      width: 800,
      height: 400,
    },
  );
}
```

![Untitled](./question-example.png)

## íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

### ì˜¤ë¥˜ ë©”ì‹œì§€ ë””ë²„ê¹… í•˜ê¸°

- ì˜¤ë¥˜ì˜ ì¤‘ê°„ì— `[cause]: Error` ë¡œ ì‹œì‘í•˜ëŠ” ë¬¸êµ¬ë¥¼ ë°œê²¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
  - ì´ ì˜ˆì œì—ì„œëŠ” `Expected <div> to have explicit "display: flex" or "display: none" if it has more than one child node.` ìì‹ì´ 1ê°œ ì´ìƒì¼ë•ŒëŠ” `display: â€œflexâ€` ë˜ëŠ” `â€œnoneâ€` ì„ ì„¤ì •í•˜ë¼ëŠ” ì˜¤ë¥˜ì…ë‹ˆë‹¤.

```text filename="error.txt"
â¨¯ Error: failed to pipe response
    // ê¸¸ê³  ê¸´ ìŠ¤íƒ íŠ¸ë ˆì´ìŠ¤
 â¡ï¸Â [cause]: Error: Expected <div> to have explicit "display: flex" or "display: none" if it has more than one child node.
      at qt (webpack-internal:///(middleware)/./node_modules/next/dist/compiled/@vercel/og/index.edge.js:16218:13)
      at qt.next (<anonymous>)
      at wl (webpack-internal:///(middleware)/./node_modules/next/dist/compiled/@vercel/og/index.edge.js:17130:20)
      at async render (webpack-internal:///(middleware)/./node_modules/next/dist/compiled/@vercel/og/index.edge.js:18780:15)
      at async Object.start (webpack-internal:///(middleware)/./node_modules/next/dist/compiled/@vercel/og/index.edge.js:19007:25)
}
```
